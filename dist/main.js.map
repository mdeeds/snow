{"version":3,"sources":["webpack:///./src/ball.js","webpack:///./src/index.js","webpack:///./src/main.js","webpack:///./src/mouseSource.js","webpack:///./src/movementSink.js","webpack:///webpack/bootstrap","webpack:///webpack/startup"],"names":[],"mappings":";;;;;;;AAAa;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,gC;;;;;;;;ACzCa;AACb,6BAA6C,CAAC,cAAc,CAAC;AAC7D,eAAe,mBAAO,CAAC,GAAQ;AAC/B;AACA;AACA,iC;;;;;;;ACLa;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,YAAY;AACZ,eAAe,mBAAO,CAAC,GAAQ;AAC/B,sBAAsB,mBAAO,CAAC,GAAe;AAC7C,uBAAuB,mBAAO,CAAC,GAAgB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,UAAU;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,mBAAmB,EAAE;AAC1D;AACA;AACA,YAAY;AACZ,gC;;;;;;;AC7Ea;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,uC;;;;;;;AC/Ba;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,oBAAoB;AACpB,eAAe,mBAAO,CAAC,GAAQ;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA,wC;;;;;;UC5FA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;UCrBA;UACA;UACA;UACA","file":"main.js","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Ball = void 0;\nclass Ball {\n    constructor(x, y, r) {\n        this.x = x;\n        this.y = y;\n        this.r = r;\n        this.c = 'lightgrey';\n    }\n    touching(other) {\n        const twor2 = other.r * other.r + this.r * this.r;\n        const dx = other.x - this.x;\n        const dy = other.y - this.y;\n        const dx2 = dx * dx;\n        const dy2 = dy * dy;\n        return (dx2 + dy2) <= twor2;\n    }\n    render(ctx) {\n        if (this.r < 6 && ctx.fillStyle !== this.c) {\n            ctx.fillStyle = this.c;\n        }\n        else {\n            const gradient = ctx.createRadialGradient(this.x + this.r * 0.2, // x1\n            this.y - this.r * 0.1, // y1\n            this.r * 0.5, // r1 \n            this.x, // x2\n            this.y, // y2\n            this.r); // r2\n            gradient.addColorStop(0, 'white');\n            gradient.addColorStop(.9, this.c);\n            gradient.addColorStop(1, 'darkgrey');\n            ctx.fillStyle = gradient;\n        }\n        ctx.beginPath();\n        ctx.arc(this.x, this.y, this.r, -Math.PI, Math.PI);\n        ctx.fill();\n    }\n}\nexports.Ball = Ball;\nBall.minRadius = 2;\n//# sourceMappingURL=ball.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst main_1 = require(\"./main\");\nconsole.log('Hello, World!');\nconst m = new main_1.Main();\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Main = void 0;\nconst ball_1 = require(\"./ball\");\nconst mouseSource_1 = require(\"./mouseSource\");\nconst movementSink_1 = require(\"./movementSink\");\nclass Main {\n    constructor() {\n        this.balls = new Set();\n        this.movers = [];\n        this.playerBalls = [];\n        this.frameNumber = 0;\n        const body = document.getElementsByTagName(\"body\")[0];\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.width = 1024;\n        this.canvas.height = 1024;\n        for (let i = 0; i < 1000; ++i) {\n            const b = new ball_1.Ball(Math.random() * 1024, Math.random() * 1024, ball_1.Ball.minRadius);\n            this.balls.add(b);\n        }\n        const b = new ball_1.Ball(Math.random() * 1024, Math.random() * 1024, ball_1.Ball.minRadius);\n        b.c = 'orange';\n        this.sink = new movementSink_1.MovementSink(b, this.balls);\n        const mouseSource = new mouseSource_1.MouseSource(this.canvas, this.sink);\n        this.movers.push(mouseSource);\n        this.playerBalls.push(b);\n        body.appendChild(this.canvas);\n        this.renderLoop();\n    }\n    bounce(a, b) {\n        const dx = b.x - a.x;\n        const dy = b.y - a.y;\n        const dx2 = dx * dx;\n        const dy2 = dy * dy;\n        const d = Math.sqrt(dx2 + dy2);\n        const minD = a.r + b.r * 1.05;\n        const p = (d - minD) / d;\n        a.x += p * dx;\n        a.y += p * dy;\n        b.x -= p * dx;\n        b.y -= p * dy;\n    }\n    renderLoop() {\n        ++this.frameNumber;\n        const ctx = this.canvas.getContext(\"2d\");\n        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        for (const b of this.balls) {\n            b.x += Math.random() - 0.5;\n            b.y += Math.random() - 0.5;\n            b.render(ctx);\n        }\n        for (const m of this.movers) {\n            m.update(this.frameNumber);\n        }\n        this.sink.update(this.frameNumber);\n        const ballsToRemove = [];\n        for (let b of this.playerBalls) {\n            b.render(ctx);\n            for (let o of this.balls) {\n                if (o.touching(b)) {\n                    if (o.r <= b.r) {\n                        b.r = Math.sqrt(o.r * o.r + b.r * b.r);\n                        ballsToRemove.push(o);\n                    }\n                    else {\n                        this.bounce(b, o);\n                    }\n                }\n            }\n        }\n        for (const b of ballsToRemove) {\n            this.balls.delete(b);\n        }\n        requestAnimationFrame(() => { this.renderLoop(); });\n    }\n}\nexports.Main = Main;\n//# sourceMappingURL=main.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MouseSource = void 0;\nclass MouseSource {\n    constructor(canvas, sink) {\n        this.x = 0;\n        this.y = 0;\n        this.split = false;\n        this.changed = true;\n        this.sink = sink;\n        canvas.addEventListener('mousemove', (ev) => {\n            this.x = ev.clientX - canvas.offsetLeft;\n            this.y = ev.clientY - canvas.offsetTop;\n            this.changed = true;\n        });\n        canvas.addEventListener('click', (ev) => {\n            this.split = true;\n        });\n    }\n    update(frameNumber) {\n        if (this.changed) {\n            this.changed = false;\n            this.sink.moveTo(this.x, this.y, frameNumber);\n        }\n        if (this.split) {\n            this.sink.split(frameNumber);\n            this.split = false;\n        }\n    }\n}\nexports.MouseSource = MouseSource;\n//# sourceMappingURL=mouseSource.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MovementSink = void 0;\nconst ball_1 = require(\"./ball\");\nclass FuturePoint {\n    constructor(frame, x, y) {\n        this.frame = frame;\n        this.x = x;\n        this.y = y;\n    }\n}\nclass MovementSink {\n    constructor(ball, nonPlayerBalls) {\n        this.lastAngle = 0;\n        this.futureDestinations = [];\n        this.futureSplits = [];\n        this.lastFrameProcessed = 0;\n        this.lastPoint = null;\n        this.ball = ball;\n        this.nonPlayerBalls = nonPlayerBalls;\n    }\n    distance(dx, dy) {\n        const dx2 = dx * dx;\n        const dy2 = dy * dy;\n        return Math.sqrt(dx2 + dy2);\n    }\n    moveTo(x, y, frameNumber) {\n        if (frameNumber >= this.lastFrameProcessed) {\n            this.futureDestinations.push(new FuturePoint(frameNumber + MovementSink.latency, x, y));\n        }\n    }\n    internalMoveTo(x, y) {\n        const maxSpeed = 30 / Math.pow(this.ball.r, 1.5);\n        const dx = x - this.ball.x;\n        const dy = y - this.ball.y;\n        const d = this.distance(dx, dy);\n        if (d <= maxSpeed) {\n            this.ball.x = x;\n            this.ball.y = y;\n        }\n        else {\n            const p = maxSpeed / d;\n            this.ball.x += p * dx;\n            this.ball.y += p * dy;\n        }\n        this.lastAngle = Math.atan2(dy, dx);\n    }\n    split(frameNumber) {\n        if (frameNumber >= this.lastFrameProcessed) {\n            this.futureSplits.push(frameNumber);\n        }\n    }\n    internalSplit() {\n        const oldRadius = this.ball.r * Math.sqrt(0.45);\n        const newRadius = this.ball.r * Math.sqrt(0.55);\n        if (newRadius < ball_1.Ball.minRadius) {\n            return;\n        }\n        const dx = this.ball.r * Math.cos(this.lastAngle);\n        const dy = this.ball.r * Math.sin(this.lastAngle);\n        const b = new ball_1.Ball(this.ball.x - dx, this.ball.y - dy, oldRadius);\n        b.c = this.ball.c;\n        this.nonPlayerBalls.add(b);\n        this.ball.x += dx;\n        this.ball.y += dy;\n        this.ball.r = newRadius;\n    }\n    update(frameNumber) {\n        let moved = false;\n        while (this.futureDestinations.length > 0 &&\n            this.futureDestinations[0].frame === frameNumber) {\n            const d = this.futureDestinations[0];\n            this.lastPoint = d;\n            this.internalMoveTo(d.x, d.y);\n            this.futureDestinations.splice(0, 1);\n            moved = true;\n        }\n        if (!moved && this.lastPoint) {\n            this.internalMoveTo(this.lastPoint.x, this.lastPoint.y);\n        }\n        if (this.futureSplits[0] === frameNumber) {\n            this.internalSplit();\n            while (this.futureSplits.length > 0 &&\n                this.futureSplits[0] === frameNumber) {\n                this.futureSplits.splice(0, 1);\n            }\n        }\n    }\n}\nexports.MovementSink = MovementSink;\n// Latency from command to action measured in frames.\nMovementSink.latency = 10;\n//# sourceMappingURL=movementSink.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module\n__webpack_require__(138);\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}